# Ameath - 桌面宠物

*"爱弥斯（Aemeath），你的桌面AI伙伴~"* 

<p align="center">
  <img src="assets\gifs\idle4.gif" alt="Ameath 桌面宠物" width="50%">
</p>

## 📝 项目说明

Aemeath是一款功能丰富的Windows桌面宠物应用，基于原版 [Ameath](https://gitee.com/lzy-buaa-jdi/ameath) 进行多次迭代开发，集成了AI对话、语音交互、划词翻译等多种实用功能。经过三代作者的共同努力，项目从最初的简单桌面宠物发展为功能全面的AI助手。

### 项目演示视频

**v3.0版本演示视频**：*（预留位置，等待作者上传）*

**v2.0版本演示视频**：[【爱弥斯-多功能桌宠】ai聊天、番茄时钟、划词翻译、音乐播放、鸣潮快速启动](https://www.bilibili.com/video/BV1qnZWBuE7K/) 


---

## ✨ 特色功能

### 🎤 语音交互系统
- 🎯 **语音唤醒** - 基于sherpa-onnx的离线关键词检测
- 🎧 **语音识别** - 阿里云ASR高精度语音转文字
- 🔊 **语音合成** - 阿里云TTS自然语音合成
- 🤖 **智能对话** - 语音识别结果自动转换为AI对话
- 🔄 **自动重连** - 网络异常时自动重试机制

### 🤖 AI对话功能
- 💬 **多服务商支持** - DeepSeek/OpenAI/千问/智谱GLM/Kimi/豆包/自定义API
- 🎭 **多种人格** - aemeath/默认/专业/可爱/傲娇五种人格可选
- 🌊 **流式回复** - 实时显示AI回复过程，提升交互体验
- 📝 **自定义模型** - 支持手动添加第三方API模型
- 🔐 **配置保存** - API配置保存在用户目录，重启不丢失

### 🌐 划词翻译功能
- 📝 **划词复制** - 选中任意文本自动复制到剪贴板
- ⌨️ **Ctrl长按翻译** - 长按Ctrl 0.5秒触发翻译面板
- 🤖 **AI翻译** - 使用已配置的AI API进行翻译
- 📋 **无感复制** - 复制后自动恢复原剪贴板内容
- 📌 **置顶切换** - 支持置顶/取消置顶
- 🌍 **多语言支持** - 支持简体中文、English、日本語等多种语言

### 🐾 智能运动系统
- 🧠 **状态机控制** - 游荡/跟随/好奇/休息，模拟真实宠物行为
- 🎭 **三种行为模式** - 安静模式、活泼模式、粘人模式
- 🖱️ **鼠标跟随** - 智能距离判断，远距离主动跟随
- 💤 **随机休息** - 随机停下休息，模拟真实作息
- 🌀 **惯性移动** - 流畅自然的运动轨迹

### 🍅 生产力功能
- 🍅 **番茄钟** - 内置番茄工作法计时器
- ⏰ **作息提醒** - 定期提醒喝水、休息、保持坐姿
- ⚡ **快速启动** - 快速右键点击宠物5次启动指定程序

### 🎵 多媒体功能
- 🎵 **背景音乐** - 支持播放背景音乐，自动连播
- 💬 **对话气泡** - 点击宠物显示问候语和互动
- 🎬 **多态动画** - 移动、待机、拖动等多种动画状态

### 🎨 界面定制
- 📏 **自由缩放** - 9档缩放（0.3x ~ 1.9x）
- 👻 **透明度调节** - 8档透明度（30% ~ 100%）
- 👆 **鼠标穿透** - 默认开启，不遮挡日常操作
- 🖼️ **安静模式动画** - 点击随机触发特殊动画

### ⚙️ 系统集成
- 🔄 **开机自启** - 支持开机自动运行
- 🖥️ **系统托盘** - 完整的右键菜单控制
- ⌨️ **全局快捷键** - 支持快捷键快速操作
- 🎯 **高DPI适配** - 完美支持高分屏
- 📦 **即开即用** - 提供打包好的exe版本

---

## 🎮 使用说明

### 基本操作
1. **启动程序** - 双击 `aemeath.exe` 启动桌面宠物
2. **托盘菜单** - 右键点击系统托盘图标进行设置
3. **快捷操作** - 双击宠物显示快捷菜单，单击显示对话气泡
4. **拖动宠物** - 需关闭鼠标穿透后，左键拖动宠物
5. **AI对话** - 使用 `Ctrl+Shift+A` 或双击宠物后点击AI按钮打开
6. **语音交互** - 在托盘菜单中启用语音功能后，说出唤醒词触发对话

### 托盘菜单功能

| 功能 | 操作 | 说明 |
|------|------|------|
| 🖼️ **隐藏/显示** | 托盘菜单切换 | 隐藏或显示宠物窗口 |
| 🤖 **AI对话** | 托盘菜单 | 打开AI聊天面板 |
| 🎤 **语音功能** | 托盘子菜单 | 启用/禁用语音交互系统 |
| 🌐 **翻译助手** | 托盘子菜单 | 打开/关闭翻译面板 |
| ⚡ **快速启动** | 托盘子菜单 | 设置并快速启动指定程序 |
| ⚙️ **AI配置** | 托盘子菜单 | 配置AI服务商和API |
| 👆 **鼠标穿透** | 托盘菜单勾选 | 开启后鼠标可以穿透宠物 |
| 🔄 **开机自启** | 托盘菜单勾选 | 开机自动运行 |
| 🎭 **行为模式** | 托盘子菜单 | 安静/活泼/粘人三种模式 |
| 🍅 **番茄钟** | 托盘子菜单 | 开始/停止/重置番茄钟 |
| 📐 **缩放** | 托盘子菜单 | 调整宠物大小（0.3x ~ 1.9x） |
| 👻 **透明度** | 托盘子菜单 | 调整宠物透明度（30% ~ 100%） |
| 🚪 **退出** | 托盘菜单 | 退出程序 |

### 快捷菜单（双击宠物）

| 功能 | 说明 |
|------|------|
| 🤖 **AI聊天** | 打开/关闭AI聊天面板 |
| 🎵 **播放/停止音乐** | 控制背景音乐播放 |
| 🐭 **跟随鼠标** | 开启/关闭自动跟随 |
| ⏸️ **暂停/继续** | 暂停或恢复宠物活动 |
| 🍅 **番茄钟** | 开始/停止番茄钟 |
| 🎭 **行为模式** | 快速切换三种行为模式 |
| 👆 **鼠标穿透** | 开启/关闭鼠标穿透 |

### 全局快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+Shift+H` | 显示/隐藏宠物 |
| `Ctrl+Shift+P` | 暂停/继续活动 |
| `Ctrl+Shift+S` | 显示快捷菜单 |
| `Ctrl+Shift+A` | 打开AI对话面板 |
| `Ctrl+Shift+Q` | 退出程序 |

---

## 🔧 安装与配置

### 系统要求
- Windows 10/11
- Python 3.12+ （开发环境）
- 麦克风（语音功能）
- 网络连接（AI功能和语音服务）

### 安装步骤

#### 方式一：直接使用exe文件（推荐）
1. 下载最新版本的 `Aemeath.exe`（窗口版本）或 `Aemeath_Console.exe`（控制台版本）
2. 双击运行即可

#### 方式二：从源码运行
1. 克隆仓库：`git clone https://github.com/your-repo/ameath_DesktopPet.git`
2. 进入目录：`cd ameath_DesktopPet`
3. 安装依赖：`pip install -r requirements.txt`
4. 运行程序：`python main.py`

#### 方式三：自行打包
1. 安装依赖：`pip install -r requirements.txt`
2. 运行打包脚本：`python build.py`
3. 打包完成后，在 `dist` 目录中找到生成的exe文件

### 调试模式

项目提供了详细的调试模式，帮助诊断问题：

#### 启用调试模式的方法

**方法1：修改配置文件**
1. 打开配置文件（位于用户目录下的 `AppData/Roaming/Aemeath_config.json`）
2. 将 `"debug_mode": false` 改为 `"debug_mode": true`
3. 保存文件并重启程序

**方法2：修改源代码**
1. 打开 `src/voice/voice_assistant.py` 文件
2. 找到以下代码块（约在第59行）：
   ```python
   # ==================== 调试模式设置 ====================
   # self.debug_mode = True  # 取消此行注释以启用调试模式
   self.debug_mode = False  # 默认关闭调试模式
   # =================================================
   ```
3. 注释掉 `self.debug_mode = False` 并取消注释 `self.debug_mode = True`
4. 保存文件并重新运行程序

#### 调试模式的作用
- 显示详细的语音识别和合成过程
- 输出API调用状态和错误信息
- 记录音频播放和接收情况
- 帮助诊断网络连接问题

#### 推荐使用场景
- 语音功能无法正常工作时
- API调用失败时排查问题
- 开发新功能时进行调试

**注意**：调试模式会产生大量日志输出，可能影响性能，建议在问题解决后关闭调试模式。

### AI配置说明

支持以下AI服务商：

| 服务商 | 默认模型 | API地址 |
|--------|----------|---------|
| DeepSeek | deepseek-chat | https://api.deepseek.com/v1 |
| OpenAI | gpt-3.5-turbo | https://api.openai.com/v1 |
| 千问 (Qwen) | qwen-plus | https://dashscope.aliyuncs.com/compatible-mode/v1 |
| 智谱GLM | glm-4-flash | https://open.bigmodel.cn/api/paas/v4 |
| Kimi | moonshot/kimi-k2-0711-preview | https://api.moonshot.ai/v1 |
| 豆包 | doubao-1.5-pro-32k | https://ark.cn-beijing.volces.com/api/v3 |
| 自定义 | 用户填写 | 用户填写 |

**配置保存位置**：Windows用户目录下 `AppData/Roaming/Aemeath_config.json`

### 翻译功能使用说明

#### 使用前提
1. 需要在 **AI配置** 中配置并启用 AI API（支持 DeepSeek、OpenAI、千问、智谱GLM、Kimi、豆包 等）
2. 需要在托盘菜单中 **启用翻译助手**

#### 使用步骤

**方式一：划词翻译**
1. 在浏览器、文档或其他应用中选中需要翻译的文本
2. 长按 **Ctrl 键 0.5 秒**，自动弹出翻译面板
3. 翻译结果将显示在面板中

**方式二：手动输入翻译**
1. 在托盘菜单中选择 **翻译助手** 打开翻译面板
2. 在原文输入框中输入或粘贴文本
3. 选择目标语言，点击 **翻译** 按钮

#### 功能特点
- **智能检测**：自动识别并跳过控制台、IDE等不安全窗口
- **无感复制**：复制后自动恢复原剪贴板内容，不影响正常使用
- **置顶功能**：点击📌按钮可切换窗口置顶状态
- **历史记录**：最近10秒内的划词内容会被缓存用于翻译

#### 注意事项
- 建议使用 `pythonw main.py` 或打包后的 exe 运行（避免控制台前台触发）
- 划词时移动距离需超过 20 像素才会触发复制
- 翻译功能依赖 AI API，会消耗 API 配额

### 语音功能配置

语音功能是v3.0版本的核心特性，包含语音唤醒、语音识别和语音合成三个部分。

#### 1. 语音唤醒配置
- **离线关键词检测**：基于sherpa-onnx实现，无需网络连接
- **默认唤醒词**："爱弥斯"（可在配置中修改）
- **模型文件**：程序首次运行时会自动下载模型文件到 `assets/models/kws/` 目录
- **自定义训练**：支持使用自己的音频数据训练唤醒词

#### 2. 语音识别配置（ASR）

**阿里云ASR配置**：
1. 访问[阿里云智能语音交互控制台](https://nls-portal.console.aliyun.com/)
2. 开通"智能语音交互"服务
3. 创建项目，获取以下信息：
   - AppKey（应用标识）
   - Token（访问令牌，可通过token管理器自动获取）
   - 服务区域（默认：wss://nls-gateway.cn-shanghai.aliyuncs.com/ws/v1）

**Token自动获取指南**：
- 程序内置了Token自动管理功能，只需配置AccessKey ID和AccessKey Secret
- Token会自动刷新，无需手动更新
- 在AI配置界面中填入AccessKey信息即可
4. 在程序中配置ASR相关参数

**支持的音频格式**：
- 采样率：16kHz
- 位深：16bit
- 声道：单声道
- 格式：PCM/WAV

#### 5. 兼容的ASR和TTS服务

**当前支持的ASR（语音识别）服务**：
1. **阿里云智能语音交互（NLS）**
   - 特点：高精度、低延迟、支持实时流式识别
   - 适用场景：实时对话、语音指令

**当前支持的TTS（语音合成）服务**：
1. **阿里云百炼CosyVoice**
   - 模型：cosyvoice-v1、cosyvoice-v3-flash（推荐）
   - 音色：longwan、cosyvoice-v3-flash-anbao1等
   - 特点：自然流畅、情感丰富、低延迟
   - 适用场景：日常对话、情感表达

**扩展支持**：
- 项目架构支持快速接入新的ASR和TTS服务
- 如需支持其他服务商，请联系项目维护者
- 可根据需求定制特定场景的语音解决方案

#### 3. 语音合成配置（TTS）

**DashScope TTS配置**：
1. 访问[阿里云百炼控制台](https://bailian.console.aliyun.com/)
2. 开通"DashScope"服务
3. 获取API-KEY
4. 在程序中配置TTS相关参数

**支持的音色和模型**：
- 模型：cosyvoice-v3-flash,cosyvoice-v3-plus等
- 音色：longwan、cosyvoice-v3-flash-aemeath1等
- 音量：0-100（可调节）

#### 4. 常见问题解决

**问题1：语音唤醒不灵敏**
- 检查麦克风是否正常工作
- 调整唤醒词检测阈值（默认0.5）
- 确保环境噪音不过大

**问题2：语音识别失败**
- 检查网络连接
- 验证ASR配置是否正确
- 启用调试模式查看详细错误信息

**问题3：语音合成无声音**
- 检查系统音量和程序音量设置
- 验证TTS API密钥是否正确
- 确保音频设备正常工作
- 启用调试模式查看详细错误信息

**问题4：打包后语音功能失效**
- 使用控制台版本（Aemeath_Console.exe）查看错误信息
- 检查是否缺少音频驱动
- 确保PyAudio相关库正确打包

---

## 🎯 v3.0版本新增功能

### 🎤 语音交互系统
- 🎯 **语音唤醒** - 基于sherpa-onnx的离线关键词检测
- 🎧 **语音识别** - 阿里云ASR高精度语音转文字
- 🔊 **语音合成** - 阿里云TTS自然语音合成
- 🤖 **智能对话** - 语音识别结果自动转换为AI对话
- 🔄 **自动重连** - 网络异常时自动重试机制

### 🧠 LLM引擎升级
- 🌊 **流式回复** - 实时显示AI回复过程，提升交互体验
- 🔧 **多服务商优化** - 统一API接口，支持更多服务商
- 🎭 **人格系统增强** - 丰富角色设定，提供更自然的对话体验
- 🛠️ **错误处理改进** - 完善的异常处理和重试机制
- ⚡ **性能优化** - 减少资源占用，提高响应速度

### 🏗️ 架构重构与优化
- 📦 **模块化架构** - 清晰的模块划分，降低耦合度
- ⚙️ **配置管理优化** - 统一的配置加载和保存机制
- 🐛 **错误处理增强** - 完善的异常捕获和错误恢复
- 📝 **日志系统** - 详细的运行日志，便于问题排查
- 🚀 **性能优化** - 减少内存占用，提高运行效率

### 🐛 Bug修复
- 🎵 **音乐播放修复** - 修复音乐自动连播时没有更新歌名的问题
- 📦 **导入错误修复** - 修复platform包导入错误的问题
- ⚙️ **配置处理优化** - 改进配置文件处理机制

### 📦 依赖管理优化
- 📋 **pyproject.toml** - 使用现代Python项目配置管理
- 🔧 **配置工具** - 添加配置修复和快速设置工具
- 📦 **依赖更新** - 更新所有依赖到最新稳定版本

---

## 📁 项目结构

```
ameath_DesktopPet/
├── assets/                    # 资源文件目录
│   ├── gifs/                 # 动画资源
│   ├── icon/                 # 图标资源
│   ├── models/               # 模型文件
│   │   └── kws/             # 关键词检测模型
│   ├── music/               # 背景音乐
│   └── voice/               # 语音文件
├── src/                     # 源代码目录
│   ├── ai/                  # AI相关模块
│   │   ├── chat_engine.py   # AI对话引擎
│   │   ├── llm_engine.py    # LLM引擎
│   │   └── config_dialog.py # AI配置对话框
│   ├── animation/           # 动画相关模块
│   ├── behavior/            # 行为控制模块
│   ├── core/                # 核心模块
│   ├── interaction/         # 交互模块
│   ├── media/               # 媒体模块
│   ├── productivity/        # 生产力功能模块
│   ├── src_platform/        # 平台相关模块
│   ├── translate/           # 翻译模块
│   ├── ui/                  # UI模块
│   ├── voice/               # 语音模块
│   │   ├── voice_assistant.py    # 语音助手
│   │   ├── voice_recognition.py  # 语音识别
│   │   └── keyword_spotter.py    # 关键词检测
│   ├── config.py            # 配置管理
│   ├── constants.py         # 常量定义
│   └── main.py              # 主程序入口
├── build.py                 # 打包脚本
├── aemeath.spec            # PyInstaller配置文件
├── requirements.txt         # 依赖列表
├── pyproject.toml          # 项目配置
└── README.md               # 项目说明
```

## 🛠️ 开发指南

### 开发环境设置

1. **克隆项目**
   ```bash
   git clone https://github.com/your-repo/ameath_DesktopPet.git
   cd ameath_DesktopPet
   ```

2. **创建虚拟环境**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   # 或
   venv\Scripts\activate  # Windows
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **运行程序**
   ```bash
   python main.py
   ```

### 代码规范

- 使用Python 3.12+语法
- 遵循PEP 8代码风格
- 添加适当的注释和文档字符串
- 使用类型提示（Type Hints）

### 调试技巧

1. **启用调试模式**：参考上文的"调试模式"章节
2. **查看日志**：调试模式下会输出详细日志
3. **使用控制台版本**：打包后使用Aemeath_Console.exe查看错误信息
4. **单元测试**：项目使用pytest进行单元测试

### 打包发布

1. **运行打包脚本**
   ```bash
   python build.py
   ```

2. **检查打包结果**
   - 窗口版本：`dist/Aemeath.exe`
   - 控制台版本：`dist/Aemeath_Console.exe`

3. **测试打包结果**
   - 在不同Windows版本上测试
   - 检查所有功能是否正常
   - 验证语音功能是否正常工作

### 贡献指南

1. Fork项目
2. 创建功能分支：`git checkout -b feature/AmazingFeature`
3. 提交更改：`git commit -m 'Add some AmazingFeature'`
4. 推送到分支：`git push origin feature/AmazingFeature`
5. 提交Pull Request

---

## 📋 更新日志

### v3.0.0 (最新)
- 🎤 新增语音交互系统（语音唤醒、识别、合成）
- 🧠 重构LLM引擎，支持流式回复
- 🏗️ 优化代码架构，提高可维护性
- 🐛 修复音乐播放和平台导入错误
- 📦 更新依赖管理，使用pyproject.toml

### v2.0.0
- 🤖 新增AI对话功能
- 🌐 新增划词翻译功能
- 🍅 新增番茄钟功能
- ⏰ 新增作息提醒功能
- ⚡ 新增快速启动功能

### v1.0.0
- 🐾 基础桌面宠物功能
- 🎵 音乐播放功能
- 🎨 基础界面定制功能
- 🖥️ 系统托盘集成

---

## 🙏 致谢与贡献者

### 历代作者成就

#### 原作者 (v1.0)
- **sinlatansen** (B站: @-fugu-) - 创建了Aemeath桌面宠物的基础框架
- 实现了基础的宠物动画、音乐播放和系统托盘功能
- 为后续开发奠定了坚实的基础

**联系方式：**
- B站主页：https://space.bilibili.com/84508966?spm_id_from=333.788.upinfo.head.click
- 原版仓库：https://gitee.com/lzy-buaa-jdi/ameath
- 介绍视频：https://www.bilibili.com/video/BV12rcMznEcG

#### 第二任作者 (v2.0)
- **_Add_One_** - 大幅扩展了桌面宠物的功能
- 添加了AI对话、划词翻译、番茄钟等实用功能
- 提升了桌宠的实用性和交互体验
- 制作了v2.0版本的演示视频

**联系方式：**
- B站主页：https://space.bilibili.com/431956262

**项目演示视频：**
- v2.0版本演示视频：[【爱弥斯-多功能桌宠】ai聊天、番茄时钟、划词翻译、音乐播放、鸣潮快速启动](https://www.bilibili.com/video/BV1qnZWBuE7K/)

#### 现作者 (v3.0)
- **wuhudelet** - 实现了完整的语音交互系统
- 重构了LLM引擎，支持流式回复
- 优化了代码架构和性能
- 修复了已知问题，提高了系统稳定性

**联系方式：**
- B站主页：https://space.bilibili.com/1359579550
- QQ：785193165

### 特别感谢

感谢以下开源项目和服务提供商：
- [sherpa-onnx](https://github.com/k2-fsa/sherpa-onnx) - 优秀的离线语音识别工具包
- [阿里云](https://www.aliyun.com/) - 提供稳定的ASR和TTS服务
- [Pillow](https://pillow.readthedocs.io/) - 强大的图像处理库
- [pystray](https://pystray.readthedocs.io/) - 简洁的系统托盘库


## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

---

## 🤝 技术支持与扩展

### 联系方式

如有以下需求，欢迎联系项目维护者：
- **技术支持**：使用中遇到的问题和解决方案
- **功能建议**：新功能的需求和设计思路
- **ASR/TTS扩展**：需要接入新的语音识别或合成服务
- **定制开发**：针对特定场景的定制化需求
- **商业合作**：商业应用和技术合作

### 扩展支持

项目采用模块化设计，支持快速扩展以下功能：

**ASR服务扩展**：
- 支持接入新的语音识别服务商
- 可定制特定领域的识别模型
- 支持多语种和方言识别

**TTS服务扩展**：
- 支持接入新的语音合成服务商
- 可定制特定音色和情感风格
- 支持SSML标记语言控制

**其他扩展**：
- 新的AI对话引擎接入
- 自定义行为模式开发
- 特定行业场景适配

### 贡献指南

我们欢迎社区贡献！以下是一些可以贡献的方向：
- 修复已知bug和问题
- 优化现有功能和性能
- 添加新的功能特性
- 完善文档和示例
- 测试和反馈

---

## ⭐ 支持项目

如果这个项目对您有帮助，请考虑给我们一个Star！您的支持是我们持续开发的动力。

---