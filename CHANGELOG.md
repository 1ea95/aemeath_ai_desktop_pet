# 更新日志

## v3.0.3 (2026-02-23)

### 🐛 Bug修复
- **#006: 快捷菜单中打开AI对话无法正常回答** - 已修复
  - 在AIChatPanel的`_send_message`方法中添加AI引擎配置检查
  - 确保在发送消息前检查AI是否已正确配置

- **#007: 托盘菜单调用AI对话时窗口类型错误** - 已修复
  - 修改托盘菜单中的"开始对话"选项，使其调用`toggle_ai_chat_panel()`
  - 统一使用AI聊天面板，而不是标准的tkinter对话框

- **#008: 快捷栏中的AI对话启动时无法正常跟随** - 已修复
  - 在`_open_ai_chat_panel`方法中，当创建新的AI聊天面板时，重新注册到UI管理器
  - 修正了AI聊天面板的尺寸，从400x300改为260x45，与实际创建的窗口尺寸一致
  - 在`_create_window`方法中，设置初始位置为桌宠右侧，避免窗口出现在屏幕左上角
  - 在`show`方法中，添加对`update_layout`的直接调用，确保布局立即更新

### 🔧 技术改进
- **AI聊天面板位置管理优化** - 改进AI聊天面板的初始化和位置计算逻辑
- **UI组件尺寸同步** - 确保UI管理器中的组件尺寸与实际窗口尺寸一致
- **窗口初始位置设置** - 在窗口创建时立即设置正确的初始位置

### 📁 文件变更
- **修改文件**:
  - `src/src_platform/tray.py` - 修改托盘菜单中的"开始对话"选项
  - `src/ui/ai_chat_panel.py` - 添加AI引擎配置检查，优化位置管理
  - `src/core/pet_core.py` - 修复AI聊天面板注册和尺寸问题

## v3.0.2 (2026-02-22)

### 🎉 重大更新
- **UI组件自动管理系统** - 全新实现UI组件自动管理器，解决UI元素相互遮挡问题
- **智能布局算法** - 自动计算最佳UI位置，避免组件重叠
- **全局缩放支持** - UI组件位置跟随缩放中心调整，保持相对位置正确

### 🐛 Bug修复
- **#001: UI元素相互遮挡** - 已修复
  - 实现UI组件自动管理器（`src/ui/ui_manager.py`）
  - 通过智能布局算法自动调整多个UI窗口的位置
  - 确保所有UI组件都能正常显示且不相互重叠

- **#002: UI组件缩放时位置不跟随中心改变** - 已修复
  - 在UI组件自动管理器中实现缩放事件处理
  - 修改拖拽处理逻辑，确保缩放时UI组件正确跟随
  - 所有UI组件会自动更新位置，保持与宠物的相对位置关系

- **#003: 隐藏桌宠时音乐播放器UI没有跟着隐藏** - 已修复
  - 实现全局UI状态管理，统一控制所有UI组件的显示/隐藏
  - 修改系统托盘和快捷菜单的隐藏/显示逻辑
  - 确保UI组件的显示状态与桌宠主窗口保持一致

- **#004: 配置列表中的不透明度错写成透明度** - 已修复（v3.0.1）
  - 将系统托盘菜单中的"透明度"更正为"不透明度"

- **#005: 系统托盘菜单状态不同步** - 已修复（v3.0.1）
  - 在快捷菜单的`_hide_pet`方法中添加系统托盘菜单更新逻辑

### 🔧 技术改进
- **UI组件位置计算优化** - 改进番茄钟位置计算逻辑，确保正确显示在歌名气泡上方
- **音乐播放状态同步** - 在音乐播放状态变化时通知UI管理器更新布局
- **番茄钟进度更新** - 修复番茄钟更新进度时没有通知UI管理器的问题
- **语法错误修复** - 修复`music_controller.py`中的语法错误

### 📁 文件变更
- **新增文件**:
  - `src/ui/ui_manager.py` - UI组件自动管理器

- **修改文件**:
  - `src/core/pet_core.py` - 集成UI管理器，修改组件注册逻辑
  - `src/ui/speech_bubble.py` - 适配UI管理器，修复位置计算
  - `src/ui/music_panel.py` - 适配UI管理器，修复位置计算
  - `src/ui/pomodoro_indicator.py` - 适配UI管理器，修复位置计算
  - `src/ui/ai_chat_panel.py` - 适配UI管理器，修复位置计算
  - `src/ui/quick_menu.py` - 修复系统托盘菜单状态同步
  - `src/interaction/drag_handler.py` - 适配UI管理器，修改拖拽逻辑
  - `src/media/music_controller.py` - 修复语法错误，添加状态同步
  - `src/src_platform/tray.py` - 修复透明度标签
  - `# Bug List - Aemeath 桌面宠物.md` - 更新bug状态

### 🎯 用户体验改进
- UI组件不再相互遮挡，提供更好的视觉体验
- 缩放时UI组件位置正确跟随，保持界面一致性
- 隐藏桌宠时所有UI组件一起隐藏，操作更加直观
- 音乐播放器显示时，番茄钟正确显示在歌名气泡上方

---

## v3.0.1 (2026-02-21)

### 🐛 Bug修复
- **#004: 配置列表中的不透明度错写成透明度** - 已修复
- **#005: 系统托盘菜单状态不同步** - 已修复

### 🔧 技术改进
- 修复系统托盘菜单中的术语错误
- 修复快捷菜单与系统托盘菜单状态不同步问题

---

## v3.0.0 (2026-02-20)

### 🎉 重大更新
- 全新的AI对话系统
- 语音交互功能
- 划词翻译功能
- 番茄钟和生产力工具
- 多媒体功能
- 界面定制选项
- 系统集成功能

### 📁 项目重构
- 基于原版 [Ameath](https://gitee.com/lzy-buaa-jdi/ameath) 进行全面重构
- 集成多种实用功能，从简单桌面宠物发展为功能全面的AI助手
- 经过三代作者的共同努力，实现功能丰富的桌面宠物应用# 更新日志

## v3.0.2 (2026-02-22)

### 🎉 重大更新
- **UI组件自动管理系统** - 全新实现UI组件自动管理器，解决UI元素相互遮挡问题
- **智能布局算法** - 自动计算最佳UI位置，避免组件重叠
- **全局缩放支持** - UI组件位置跟随缩放中心调整，保持相对位置正确

### 🐛 Bug修复
- **#001: UI元素相互遮挡** - 已修复
  - 实现UI组件自动管理器（`src/ui/ui_manager.py`）
  - 通过智能布局算法自动调整多个UI窗口的位置
  - 确保所有UI组件都能正常显示且不相互重叠

- **#002: UI组件缩放时位置不跟随中心改变** - 已修复
  - 在UI组件自动管理器中实现缩放事件处理
  - 修改拖拽处理逻辑，确保缩放时UI组件正确跟随
  - 所有UI组件会自动更新位置，保持与宠物的相对位置关系

- **#003: 隐藏桌宠时音乐播放器UI没有跟着隐藏** - 已修复
  - 实现全局UI状态管理，统一控制所有UI组件的显示/隐藏
  - 修改系统托盘和快捷菜单的隐藏/显示逻辑
  - 确保UI组件的显示状态与桌宠主窗口保持一致

- **#004: 配置列表中的不透明度错写成透明度** - 已修复（v3.0.1）
  - 将系统托盘菜单中的"透明度"更正为"不透明度"

- **#005: 系统托盘菜单状态不同步** - 已修复（v3.0.1）
  - 在快捷菜单的`_hide_pet`方法中添加系统托盘菜单更新逻辑

### 🔧 技术改进
- **UI组件位置计算优化** - 改进番茄钟位置计算逻辑，确保正确显示在歌名气泡上方
- **音乐播放状态同步** - 在音乐播放状态变化时通知UI管理器更新布局
- **番茄钟进度更新** - 修复番茄钟更新进度时没有通知UI管理器的问题
- **语法错误修复** - 修复`music_controller.py`中的语法错误

### 📁 文件变更
- **新增文件**:
  - `src/ui/ui_manager.py` - UI组件自动管理器

- **修改文件**:
  - `src/core/pet_core.py` - 集成UI管理器，修改组件注册逻辑
  - `src/ui/speech_bubble.py` - 适配UI管理器，修复位置计算
  - `src/ui/music_panel.py` - 适配UI管理器，修复位置计算
  - `src/ui/pomodoro_indicator.py` - 适配UI管理器，修复位置计算
  - `src/ui/ai_chat_panel.py` - 适配UI管理器，修复位置计算
  - `src/ui/quick_menu.py` - 修复系统托盘菜单状态同步
  - `src/interaction/drag_handler.py` - 适配UI管理器，修改拖拽逻辑
  - `src/media/music_controller.py` - 修复语法错误，添加状态同步
  - `src/src_platform/tray.py` - 修复透明度标签
  - `# Bug List - Aemeath 桌面宠物.md` - 更新bug状态

### 🎯 用户体验改进
- UI组件不再相互遮挡，提供更好的视觉体验
- 缩放时UI组件位置正确跟随，保持界面一致性
- 隐藏桌宠时所有UI组件一起隐藏，操作更加直观
- 音乐播放器显示时，番茄钟正确显示在歌名气泡上方

---

## v3.0.1 (2026-02-21)

### 🐛 Bug修复
- **#004: 配置列表中的不透明度错写成透明度** - 已修复
- **#005: 系统托盘菜单状态不同步** - 已修复

### 🔧 技术改进
- 修复系统托盘菜单中的术语错误
- 修复快捷菜单与系统托盘菜单状态不同步问题

---

## v3.0.0 (2026-02-20)

### 🎉 重大更新
- 全新的AI对话系统
- 语音交互功能
- 划词翻译功能
- 番茄钟和生产力工具
- 多媒体功能
- 界面定制选项
- 系统集成功能

### 📁 项目重构
- 基于原版 [Ameath](https://gitee.com/lzy-buaa-jdi/ameath) 进行全面重构
- 集成多种实用功能，从简单桌面宠物发展为功能全面的AI助手
- 经过三代作者的共同努力，实现功能丰富的桌面宠物应用