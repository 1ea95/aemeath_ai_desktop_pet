# Bug List - Ameath 桌面宠物

本文档用于记录Ameath桌面宠物测试过程中发现的bug和问题。

## Bug列表

### Bug #001: UI元素相互遮挡
**严重程度**: 中等  
**状态**: 未解决  
**发现日期**: 2026-02-21  
**影响模块**: 番茄钟、音乐播放器UI  

**问题描述**:  
番茄钟和音乐播放器的UI界面会相互遮挡，当两个功能同时开启时，其中一个界面会被另一个界面覆盖，影响用户交互体验。

**复现步骤**:  
1. 启动Ameath桌面宠物
2. 开启番茄钟功能
3. 开启音乐播放器功能
4. 观察两个UI界面的显示情况

**预期结果**:  
两个UI界面应该合理布局，不相互遮挡，用户可以同时看到并操作两个界面。

**实际结果**:  
其中一个UI界面被另一个界面覆盖，无法正常查看或操作被覆盖的界面。

**可能原因**:  
- UI元素的z-index层级设置不当
- 窗口位置计算逻辑存在问题
- 缺乏多窗口布局管理机制

**建议解决方案**:  
1. 实现智能布局算法，自动调整多个UI窗口的位置
2. 添加窗口层级管理，确保重要UI始终可见
3. 提供手动调整UI位置的功能
4. 考虑将多个功能整合到一个统一的控制面板中

**相关文件**:  
- `src/ui/pomodoro_indicator.py` - 番茄钟UI
- `src/ui/music_panel.py` - 音乐播放器UI
- `src/core/window_manager.py` - 窗口管理器

---

### Bug #002: UI组件缩放时位置不跟随中心改变
**严重程度**: 中等  
**状态**: 未解决  
**发现日期**: 2026-02-21  
**影响模块**: 所有UI组件  

**问题描述**:  
当存在UI组件时改变缩放比例，所有种类的UI都没有跟随位置中心进行相应调整，导致UI位置偏移，影响用户体验。

**复现步骤**:  
1. 启动Ameath桌面宠物
2. 打开任意UI组件（如番茄钟、音乐播放器、AI聊天面板等）
3. 改变桌面宠物的缩放比例
4. 观察UI组件的位置变化

**预期结果**:  
UI组件应该以宠物为中心，跟随缩放比例进行位置调整，保持相对位置的正确性。

**实际结果**:  
UI组件位置没有跟随缩放中心进行调整，导致UI与宠物的相对位置发生偏移。

**可能原因**:  
- 缩放变换只应用于宠物本体，未同步到UI组件
- UI组件位置计算没有考虑缩放因子
- 缺乏全局的缩放事件通知机制

**建议解决方案**:  
1. 实现全局缩放事件通知系统，所有UI组件监听缩放变化
2. 在缩放变换时同步更新所有UI组件的位置
3. 将UI组件位置计算改为相对于宠物中心的相对坐标
4. 添加缩放因子到UI组件的位置计算公式中

**相关文件**:  
- `src/ui/` 目录下的所有UI组件文件
- `src/core/window_manager.py` - 窗口管理器
- `src/behavior/motion_controller.py` - 运动控制器

---

### Bug #003: 隐藏桌宠时音乐播放器UI没有跟着隐藏
**严重程度**: 中等  
**状态**: 未解决  
**发现日期**: 2026-02-21  
**影响模块**: 音乐播放器UI、桌宠显示控制  

**问题描述**:  
当音乐播放器UI显示时，选择隐藏桌宠功能，音乐播放器UI没有跟着一起隐藏，仍然显示在桌面上，与用户预期不符。

**复现步骤**:  
1. 启动Ameath桌面宠物
2. 打开音乐播放器UI
3. 右键点击桌宠，选择隐藏桌宠选项
4. 观察音乐播放器UI的显示状态

**预期结果**:  
隐藏桌宠时，所有相关的UI组件（包括音乐播放器）应该一起隐藏，保持界面的一致性。

**实际结果**:  
桌宠被隐藏了，但音乐播放器UI仍然显示在桌面上。

**可能原因**:  
- 隐藏桌宠功能只处理了主窗口的隐藏，没有通知其他UI组件
- 音乐播放器UI与桌宠主窗口的生命周期没有关联
- 缺乏全局的UI显示/隐藏状态管理机制

**建议解决方案**:  
1. 实现全局UI状态管理，统一控制所有UI组件的显示/隐藏
2. 在隐藏桌宠时发送通知事件，所有UI组件监听并响应
3. 将音乐播放器等UI组件的显示状态与桌宠主窗口绑定
4. 添加UI组件注册机制，便于统一管理

**相关文件**:  
- `src/ui/music_panel.py` - 音乐播放器UI
- `src/core/window_manager.py` - 窗口管理器
- `src/src_platform/tray.py` - 系统托盘功能
- `src/core/pet_core.py` - 宠物核心逻辑

---

### Bug #004: 配置列表中的不透明度错写成透明度
**严重程度**: 低  
**状态**: 未解决  
**发现日期**: 2026-02-21  
**影响模块**: 配置界面  

**问题描述**:  
在配置列表中，控制桌宠不透明度的选项被错误地标记为"透明度"，导致用户界面术语不准确，可能引起用户困惑。

**复现步骤**:  
1. 启动Ameath桌面宠物
2. 打开配置界面
3. 查找控制桌宠显示透明度的选项
4. 观察选项标签文字

**预期结果**:  
配置选项应该正确标记为"不透明度"，因为该参数实际控制的是桌宠的不透明程度（值越高越不透明）。

**实际结果**:  
配置选项被错误地标记为"透明度"，与实际功能不符。

**可能原因**:  
- 开发时的命名错误或翻译错误
- 对透明度/不透明度概念理解有误
- 代码实现与UI标签不一致

**建议解决方案**:  
1. 将配置选项标签从"透明度"改为"不透明度"
2. 确保所有相关文档和提示信息使用一致的术语
3. 检查其他可能存在类似问题的UI文本
4. 添加工具提示说明该参数的作用

**相关文件**:  
- `src/ui/quick_menu.py` - 快速菜单（可能包含配置选项）
- `src/config.py` - 配置管理
- `src/ai/config_dialog.py` - AI配置对话框
- `src/ai/simple_config_dialog.py` - 简单配置对话框

---

### Bug #005: 系统托盘菜单状态不同步
**严重程度**: 中等  
**状态**: 未解决  
**发现日期**: 2026-02-21  
**影响模块**: 系统托盘、快捷菜单  

**问题描述**:  
在双击桌宠出现的快捷栏中选择隐藏时，系统托盘菜单没有同步将配置项从"隐藏"改成"显示"，导致菜单状态与实际桌宠显示状态不一致。

**复现步骤**:  
1. 启动Ameath桌面宠物
2. 双击桌宠打开快捷菜单
3. 在快捷菜单中选择"隐藏"选项
4. 查看系统托盘右键菜单中的显示/隐藏选项

**预期结果**:  
系统托盘菜单中的显示/隐藏选项应该与桌宠的实际状态保持同步，当桌宠被隐藏时，选项应该显示为"显示"。

**实际结果**:  
系统托盘菜单中的选项仍然显示为"隐藏"，与桌宠实际被隐藏的状态不符。

**可能原因**:  
- 快捷菜单和系统托盘菜单使用不同的状态变量
- 缺乏全局状态管理机制
- 隐藏操作没有通知所有相关UI组件更新状态

**建议解决方案**:  
1. 实现全局状态管理，统一管理桌宠的显示/隐藏状态
2. 在状态改变时通知所有相关UI组件更新
3. 使用观察者模式，让所有UI组件监听状态变化
4. 确保所有显示/隐藏操作使用同一个状态变量

**相关文件**:  
- `src/src_platform/tray.py` - 系统托盘功能
- `src/ui/quick_menu.py` - 快速菜单
- `src/core/state_manager.py` - 状态管理器
- `src/core/pet_core.py` - 宠物核心逻辑

---

### Bug #003: 隐藏桌宠时音乐播放器UI没有跟着隐藏
**严重程度**: 中等  
**状态**: 未解决  
**发现日期**: 2026-02-21  
**影响模块**: 音乐播放器UI、桌宠显示控制  

**问题描述**:  
当音乐播放器UI显示时，选择隐藏桌宠功能，音乐播放器UI没有跟着一起隐藏，仍然显示在桌面上，与用户预期不符。

**复现步骤**:  
1. 启动Ameath桌面宠物
2. 打开音乐播放器UI
3. 右键点击桌宠，选择隐藏桌宠选项
4. 观察音乐播放器UI的显示状态

**预期结果**:  
隐藏桌宠时，所有相关的UI组件（包括音乐播放器）应该一起隐藏，保持界面的一致性。

**实际结果**:  
桌宠被隐藏了，但音乐播放器UI仍然显示在桌面上。

**可能原因**:  
- 隐藏桌宠功能只处理了主窗口的隐藏，没有通知其他UI组件
- 音乐播放器UI与桌宠主窗口的生命周期没有关联
- 缺乏全局的UI显示/隐藏状态管理机制

**建议解决方案**:  
1. 实现全局UI状态管理，统一控制所有UI组件的显示/隐藏
2. 在隐藏桌宠时发送通知事件，所有UI组件监听并响应
3. 将音乐播放器等UI组件的显示状态与桌宠主窗口绑定
4. 添加UI组件注册机制，便于统一管理

**相关文件**:  
- `src/ui/music_panel.py` - 音乐播放器UI
- `src/core/window_manager.py` - 窗口管理器
- `src/src_platform/tray.py` - 系统托盘功能
- `src/core/pet_core.py` - 宠物核心逻辑

---

### Bug #004: 配置列表中的不透明度错写成透明度
**严重程度**: 低  
**状态**: 未解决  
**发现日期**: 2026-02-21  
**影响模块**: 配置界面  

**问题描述**:  
在配置列表中，控制桌宠不透明度的选项被错误地标记为"透明度"，导致用户界面术语不准确，可能引起用户困惑。

**复现步骤**:  
1. 启动Ameath桌面宠物
2. 打开配置界面
3. 查找控制桌宠显示透明度的选项
4. 观察选项标签文字

**预期结果**:  
配置选项应该正确标记为"不透明度"，因为该参数实际控制的是桌宠的不透明程度（值越高越不透明）。

**实际结果**:  
配置选项被错误地标记为"透明度"，与实际功能不符。

**可能原因**:  
- 开发时的命名错误或翻译错误
- 对透明度/不透明度概念理解有误
- 代码实现与UI标签不一致

**建议解决方案**:  
1. 将配置选项标签从"透明度"改为"不透明度"
2. 确保所有相关文档和提示信息使用一致的术语
3. 检查其他可能存在类似问题的UI文本
4. 添加工具提示说明该参数的作用

**相关文件**:  
- `src/ui/quick_menu.py` - 快速菜单（可能包含配置选项）
- `src/config.py` - 配置管理
- `src/ai/config_dialog.py` - AI配置对话框
- `src/ai/simple_config_dialog.py` - 简单配置对话框

---

### Bug #005: 系统托盘菜单状态不同步
**严重程度**: 中等  
**状态**: 未解决  
**发现日期**: 2026-02-21  
**影响模块**: 系统托盘、快捷菜单  

**问题描述**:  
在双击桌宠出现的快捷栏中选择隐藏时，系统托盘菜单没有同步将配置项从"隐藏"改成"显示"，导致菜单状态与实际桌宠显示状态不一致。

**复现步骤**:  
1. 启动Ameath桌面宠物
2. 双击桌宠打开快捷菜单
3. 在快捷菜单中选择"隐藏"选项
4. 查看系统托盘右键菜单中的显示/隐藏选项

**预期结果**:  
系统托盘菜单中的显示/隐藏选项应该与桌宠的实际状态保持同步，当桌宠被隐藏时，选项应该显示为"显示"。

**实际结果**:  
系统托盘菜单中的选项仍然显示为"隐藏"，与桌宠实际被隐藏的状态不符。

**可能原因**:  
- 快捷菜单和系统托盘菜单使用不同的状态变量
- 缺乏全局状态管理机制
- 隐藏操作没有通知所有相关UI组件更新状态

**建议解决方案**:  
1. 实现全局状态管理，统一管理桌宠的显示/隐藏状态
2. 在状态改变时通知所有相关UI组件更新
3. 使用观察者模式，让所有UI组件监听状态变化
4. 确保所有显示/隐藏操作使用同一个状态变量

**相关文件**:  
- `src/src_platform/tray.py` - 系统托盘功能
- `src/ui/quick_menu.py` - 快速菜单
- `src/core/state_manager.py` - 状态管理器
- `src/core/pet_core.py` - 宠物核心逻辑

---

## Bug报告模板

如需添加新的bug，请使用以下格式：

### Bug #[编号]: [简短描述]
**严重程度**: [低/中/高/严重]  
**状态**: [未解决/处理中/已解决/已验证]  
**发现日期**: [YYYY-MM-DD]  
**影响模块**: [受影响的模块名称]  

**问题描述**:  
[详细描述bug的具体表现和影响]

**复现步骤**:  
1. [步骤1]
2. [步骤2]
3. [步骤3]

**预期结果**:  
[描述应该出现的正确结果]

**实际结果**:  
[描述实际发生的错误结果]

**可能原因**:  
[分析可能导致bug的原因]

**建议解决方案**:  
[提供修复建议]

**相关文件**:  
[列出可能相关的代码文件路径]